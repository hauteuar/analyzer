flowchart LR
    %% User
    U([User<br/>Ops Team / FAs]):::user -->|Query| A[Opulence AI Agent]:::agent

    %% Cache check
    A --> B{Check Cache?}:::decision

    %% Cache Hit Path
    subgraph HIT[Cache Hit Path]
        direction LR
        B -->|Yes| C[Retrieve Answer<br/>from Cache]:::process
        C --> S[Summarizer]:::process
        S --> R[Response Generator]:::process
        R --> U
    end

    %% Cache Miss Path
    subgraph MISS[Cache Miss Path]
        direction LR
        B -->|No| M[Check Chat Session Memory]:::memory
        M --> EN[Enriched Query]:::process

        %% Model selection
        EN --> SEL{LLM / SLM Selector}:::decision
        SEL -->|Simple| SLM[Small Language Model]:::slm
        SEL -->|Complex| LLM[Large Language Model]:::llm

        %% Routing
        SLM --> ROUTE{Query Type?}:::decision
        LLM --> ROUTE

        ROUTE -->|Pricing Query| DB[(Oracle DB<br/>Pricing Data)]:::database
        ROUTE -->|Business Logic Query| DOCS[(Document Knowledge Base)]:::database

        %% Retrieval
        DB --> RET[Retrieve Results]:::process
        DOCS --> RET2[Retrieve Results via RAG]:::process

        RET --> S2[Summarizer]:::process
        RET2 --> S2
        S2 --> R2[Response Generator]:::process
        R2 --> U

        %% Feedback Loop
        R2 --> CACHE[(Store in Cache for Reuse)]:::cache
        CACHE --> B
    end

    %% Styles
    classDef user fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#0d47a1
    classDef agent fill:#ede7f6,stroke:#512da8,stroke-width:2px,color:#311b92
    classDef process fill:#f1f8e9,stroke:#33691e,stroke-width:1.5px,color:#1b5e20
    classDef decision fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#e65100
    classDef database fill:#e0f7fa,stroke:#00838f,stroke-width:2px,color:#006064
    classDef memory fill:#fce4ec,stroke:#ad1457,stroke-width:2px,color:#880e4f
    classDef cache fill:#eeeeee,stroke:#424242,stroke-width:2px,color:#212121
    classDef llm fill:#ede7f6,stroke:#4527a0,stroke-width:2px,color:#311b92
    classDef slm fill:#f9fbe7,stroke:#827717,stroke-width:2px,color:#33691e
